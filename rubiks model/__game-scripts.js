var ColorEvent=pc.createScript("colorEvent");ColorEvent.attributes.add("eventName",{type:"string",title:"Event Name"}),ColorEvent.attributes.add("color",{type:"rgba",title:"Color"}),ColorEvent.prototype.initialize=function(){this.entity.button.on("click",(function(){this.app.fire(this.eventName,this.color)}),this)};var NumberEvent=pc.createScript("numberEvent");NumberEvent.attributes.add("eventName",{type:"string",title:"Event Name"}),NumberEvent.attributes.add("number",{type:"number",title:"Number"}),NumberEvent.prototype.initialize=function(){this.entity.button.on("click",(function(){this.app.fire(this.eventName,this.number)}),this)};var Controller=pc.createScript("controller");Controller.attributes.add("visualEntity",{type:"entity"}),Controller.prototype.initialize=function(){this.ray=new pc.Ray,this.vecA=new pc.Vec3,this.vecB=new pc.Vec3,this.matA=new pc.Mat4,this.quat=new pc.Quat,this.color=new pc.Color(1,1,1),this.inputSource.once("remove",(function(){this.entity.destroy()}),this)},Controller.prototype.update=function(t){this.vecA.copy(this.inputSource.getOrigin()),this.vecB.copy(this.inputSource.getDirection()),this.vecB.scale(1e3).add(this.vecA),this.inputSource.selecting?this.color.set(1,.375,0):this.color.set(1,1,1),this.app.renderLine(this.vecA,this.vecB,this.color),this.inputSource.grip?(this.visualEntity.enabled=!0,this.entity.setPosition(this.inputSource.getPosition()),this.entity.setRotation(this.inputSource.getRotation())):(this.visualEntity.enabled=!1,this.entity.setLocalPosition(0,0,0),this.vecA.set(0,0,0),this.vecB.set(0,1,0),this.matA.setLookAt(this.vecA,this.inputSource.getDirection(),this.vecB),this.quat.setFromMat4(this.matA),this.entity.setRotation(this.quat))};var Controllers=pc.createScript("controllers");Controllers.attributes.add("controllerTemplate",{type:"entity"}),Controllers.prototype.initialize=function(){this.app.xr.input.on("add",this.onAdd,this)},Controllers.prototype.onAdd=function(t){var o=this.controllerTemplate.clone();o.script.controller.inputSource=t,o.reparent(this.app.scene.root),o.enabled=!0};var Xr=pc.createScript("xr");Xr.attributes.add("buttonVr",{type:"entity"}),Xr.attributes.add("buttonAr",{type:"entity"}),Xr.attributes.add("cameraEntity",{type:"entity"}),Xr.prototype.initialize=function(){this.buttonVr.button.active=this.app.xr.supported&&this.app.xr.isAvailable(pc.XRTYPE_VR),this.buttonAr.button.active=this.app.xr.supported&&this.app.xr.isAvailable(pc.XRTYPE_AR),this.clearColor=this.cameraEntity.camera.clearColor.clone(),this.clearColorAR=new pc.Color(0,0,0,0),this.buttonVr.element.on("click",(function(){var t=function(){this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR)}.bind(this);this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(i){"granted"==i&&window.addEventListener("deviceorientation",function(i){t()}.bind(this))}.bind(this)).catch(console.error):t())}),this),this.buttonAr.element.on("click",(function(){this.app.xr.isAvailable(pc.XRTYPE_AR)&&this.cameraEntity.camera.startXr(pc.XRTYPE_AR,pc.XRSPACE_LOCALFLOOR)}),this),this.app.keyboard.on("keydown",(function(t){t.key===pc.KEY_ESCAPE&&this.app.xr.end()}),this),this.app.xr.on("start",(function(){this.buttonVr.enabled=!1,this.buttonAr.enabled=!1,this.app.xr.type===pc.XRTYPE_AR&&(this.cameraEntity.camera.clearColor=this.clearColorAR,this.app.scene.root.findByTag("nonAr").forEach((function(t){t.render.enabled=!1})))}),this),this.app.xr.on("end",(function(){this.buttonVr.enabled=!0,this.buttonAr.enabled=!0,this.cameraEntity.camera.clearColor=this.clearColor,this.app.scene.root.findByTag("nonAr").forEach((function(t){t.render.enabled=!0}))}),this),this.app.xr.on("available",(function(){this.buttonVr.button.active=this.app.xr.supported&&this.app.xr.isAvailable(pc.XRTYPE_VR),this.buttonAr.button.active=this.app.xr.supported&&this.app.xr.isAvailable(pc.XRTYPE_AR)}),this)};var Cube=pc.createScript("cube");Cube.prototype.initialize=function(){this.rotateSpeed=0,this.app.on("setrotation",(function(t){this.rotateSpeed=t}),this),this.app.on("setcolor",(function(t){for(var e=this.entity.findComponents("render"),i=0;i<e.length;++i)for(var o=e[i].meshInstances,n=0;n<o.length;n++)o[n].material.diffuse.copy(t),o[n].material.update()}),this)},Cube.prototype.update=function(t){this.entity.rotate(0,this.rotateSpeed*t,0)};